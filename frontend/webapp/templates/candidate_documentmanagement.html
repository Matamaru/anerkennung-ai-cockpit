<!--  Application:    Anerkennung AI Cockpit                                -->
<!--  Module:         templates.candidate_documentmanagement                -->
<!--  Author:         Heiko Matamaru, IGS                                   -->
<!--  Version:        0.0.1                                                 -->
{% extends 'base.html' %}

{% block title %} Document Management - Candidate Dashboard {% endblock %}
{% block meta_description %} Manage documents for the Anerkennung AI Cockpit. {% endblock %}

{% block content %}
  <div class="container py-4">
    <div class="row">

      <!-- LEFT: Requirements list -->
      <div class="col-md-4 mb-3">
        <h5>Requirements</h5
        <ul class="list-group">
          {% for req in requirements %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ req.name }}</strong>
                <p class="small text-muted">{{ req.description }}</p>
              </div>

              <!-- Upload button for each requirement -->
              <form method="POST" action="{{ url_for('candidate.document_management') }}" enctype="multipart/form-data">
                <input type="hidden" name="requirement_id" value="{{ req.id }}">
                <input type="hidden" name="application_id" value="{{ application_id }}">
                <input type="file" name="document" required>
                <button type="submit" class="btn btn-sm btn-primary">Upload Document</button>
              </form>
            </li>
          {% endfor %}
        </ul>
      </div>

      <!-- RIGHT: Uploaded Documents for selected application -->
      <div class="col-md-6 mb-3">
        <h5>Uploaded Documents</h5>
        {% if application_id %}
          {% for doc in documents %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <strong>{{ doc.document_type_name }}</strong>
                <p class="small text-muted">{{ doc.filename }}</p>
              </div>

              <!-- Status Badge -->
              <span class="badge {% if doc.status_id == 'approved' %}bg-success{% elif doc.status_id == 'pending' %}bg-warning{% else %}bg-secondary{% endif %}">
                {{ doc.status_id }}
              </span>

              <!-- Actions: Details & Delete -->
              <div class="btn-group">
                <a href="{{ url_for('candidate.document_details', document_id=doc.document_id) }}" class="btn btn-sm btn-info">Details</a>
                <a href="{{ url_for('candidate.delete_document', document_id=doc.document_id) }}" class="btn btn-sm btn-danger">Delete</a>
              </div>
            </div>
          {% else %}
            <div class="alert alert-info">
              No documents uploaded for this application.
            </div>
          {% endfor %}
        {% else %}
          <div class="alert alert-warning">
            Please select an application from the left to manage its documents.
          </div>
        {% endif %}
      </div>

    </div>
  </div>

<!-- JavaScript to enforce max file size on client side -->
<script>
  // Max file size in MB
  const MAX_FILE_SIZE_MB = 16 ; // Adjust this value as needed
  
  // Function to check file size before form submission
  function checkFileSize(event) {
    const fileInput = event.target;
    const file = fileInput.files[0];
    
    if (file) {
      const fileSizeMB = file.size / (1024 * 1024); // Size in MB
      if (fileSizeMB > MAX_FILE_SIZE_MB) {
        alert(`File size exceeds the maximum limit of ${MAX_FILE_SIZE_MB} MB.`);
        fileInput.value = ''; // Clear the file input
        return false; // Prevent form submission
      }
    }
    return true; // Allow form submission
  }

  // Add event listeners for each file input
  document.querySelectorAll('input[type="file"]').forEach(input => {
    input.addEventListener('change', checkFileSize);
  });
</script>
{% endblock %}