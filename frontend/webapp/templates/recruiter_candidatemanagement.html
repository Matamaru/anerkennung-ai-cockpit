<!--  Application:    Anerkennung AI Cockpit                                -->
<!--  Module:         templates.recruiter_dashboard_candidatemanagement     -->
<!--  Author:         Heiko Matamaru, IGS                                   -->
<!--  Version:        0.0.1                                                 -->

{% extends 'base.html' %}

    
{% block title %} Candidate Management - Recruiter Dashboard {% endblock %}
{% block meta_description %} Manage candidates for the Anerkennung AI Cockpit. {% endblock %}

{% block content %}
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5 class="mb-0">Candidates</h5>
      <form class="d-flex gap-2" method="get" action="{{ url_for('recruiter.candidate_management') }}">
        <input type="search" name="q" class="form-control form-control-sm" placeholder="Search name or email" value="{{ query or '' }}">
        <button type="submit" class="btn btn-sm btn-outline-primary">Search</button>
      </form>
    </div>

    {% if candidates %}
      <div class="row">
        <div class="col-lg-6">
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th class="text-center">Applications</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                {% for c in candidates %}
                  <tr>
                    <td>{{ c.username }}</td>
                    <td>{{ c.email }}</td>
                    <td class="text-center">{{ c.application_count }}</td>
                    <td class="text-end">
                      <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('recruiter.candidate_management', user_id=c.user_id) }}">
                        View Applications
                      </a>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-lg-6">
          {% if selected_user %}
            <div class="card">
              <div class="card-body">
                <h6 class="card-title mb-2">{{ selected_user.username }}</h6>
                <div class="text-muted small mb-3">{{ selected_user.email }}</div>
                {% if applications %}
                  <div class="list-group list-group-flush">
                    {% for app in applications %}
                      <a class="list-group-item list-group-item-action {% if selected_app_id == app.id %}active{% endif %}"
                         href="{{ url_for('recruiter.candidate_management', user_id=selected_user.user_id, app_id=app.id) }}">
                        <div class="fw-semibold">{{ app.profession_name }}</div>
                        <div class="small text-muted">
                          {{ app.country_name }} · {{ app.state_name }}
                        </div>
                        <div class="small text-muted">
                          Created: {{ app.time_created }}
                        </div>
                      </a>
                    {% endfor %}
                  </div>
                {% else %}
                  <div class="alert alert-info mb-0">No applications for this candidate.</div>
                {% endif %}
              </div>
            </div>
            {% if selected_app_id %}
              <div class="card mt-3">
                <div class="card-body">
                  <h6 class="card-title mb-2">Documents</h6>
                  {% if documents %}
                    <div class="list-group list-group-flush">
                      {% for doc in documents %}
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                          <div>
                            <div class="fw-semibold">{{ doc.requirement_name }}</div>
                            <div class="small text-muted">{{ doc.document_type_name }} · {{ doc.filename }}</div>
                          </div>
                          <div class="d-flex flex-column align-items-end me-2">
                            <span class="badge {% if doc.status_name == 'approved' %}bg-success{% elif doc.status_name == 'pending' %}bg-warning{% else %}bg-secondary{% endif %} mb-1">
                              {{ doc.status_name or 'unknown' }}
                            </span>
                            {% set review_status = doc.review_status or 'pending' %}
                            <span class="badge {% if review_status == 'approved' %}bg-success{% elif review_status == 'declined' %}bg-danger{% else %}bg-secondary{% endif %}">
                              {{ review_status }}
                            </span>
                          </div>
                          <div class="btn-group">
                            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('recruiter.document_details', document_id=doc.document_id, user_id=selected_user.user_id, app_id=selected_app_id) }}">
                              Details
                            </a>
                            <a class="btn btn-sm btn-outline-primary" href="{{ url_for('recruiter.view_document', document_id=doc.document_id, user_id=selected_user.user_id, app_id=selected_app_id) }}" target="_blank" rel="noopener">
                              Open
                            </a>
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                  {% else %}
                    <div class="alert alert-info mb-0">No documents linked to this application.</div>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% else %}
            <div class="alert alert-secondary">Select a candidate to view applications.</div>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="alert alert-info">No candidates found.</div>
    {% endif %}
  </div>


{% endblock %}
